<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>서청문 예약현황 사이트</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap');
    html, body {
      height: 100%;
      margin: 0;
      background: linear-gradient(135deg, #e0f7fa, #fffde7);
      font-family: 'Nanum Gothic', 'Noto Sans KR', sans-serif;
      color: #3a3a3a;
    }
    #categoryDisplay {
      width: 100%;
      height: 100%;
      padding: 40px 50px;
      box-sizing: border-box;
      overflow-y: auto;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    #categoryDisplay.show { opacity: 1; }
    h2 {
      color: #00796b;
      margin-top: 0;
      font-size: 3em;
      font-weight: 800;
      padding-bottom: 14px;
      text-align: center;
      letter-spacing: 1px;
      user-select: none;
    }
    .notice-box {
      margin: 0 auto 20px auto;
      max-width: 700px;
      background: #e0f7fa;
      color: #00796b;
      font-size: 1.6em;
      font-weight: bold;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid #4db6ac;
      line-height: 2;
    }
    hr {
      border: none;
      border-top: 3px solid #4db6ac;
      margin: 20px 0;
    }
    table {
      border-collapse: separate;
      border-spacing: 0 12px;
      margin-top: 10px;
      width: 100%;
      font-size: 1.4em;
      background: transparent;
      user-select: none;
      table-layout: fixed;
    }
    th {
      background-color: #4db6ac;
      color: white;
      padding: 14px 20px;
      text-align: center;
      font-weight: 700;
      border-radius: 10px 10px 0 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      word-wrap: break-word;
    }
    td {
      background: #e0f2f1;
      color: #004d40;
      padding: 16px 20px;
      text-align: center;
      font-weight: 600;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      white-space: normal;
      word-break: break-word;
      max-width: 180px;
      overflow-wrap: break-word;
    }
    td.name-cell {
      white-space: normal !important;
      word-break: break-word;
      max-width: 180px;
    }
    tr:nth-of-type(even) td { background: #b2dfdb; }
    tr:hover td {
      background: #80cbc4;
      color: #00251a;
      cursor: default;
      transition: background-color 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="categoryDisplay">로딩 중...</div>

  <script>
    const sources = [
      { name: "컴퓨터", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=389966305&single=true&output=csv" },
      { name: "노래연습실", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=459320473&single=true&output=csv" },
      { name: "미디어실", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=1373134857&single=true&output=csv" },
      { name: "체육활동실", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=93372477&single=true&output=csv" },
      { name: "북카페", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=660141070&single=true&output=csv" },
      { name: "청운위실", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=1485760318&single=true&output=csv" },
      { name: "개인연습실", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=956982417&single=true&output=csv" }
    ];

    const visibleColumns = {
      "컴퓨터": [1,5,6,16,17],
      "노래연습실": [1,5,6,14,15],
      "미디어실": [1,7,8,9],
      "체육활동실": [1,7,6,12,13],
      "북카페": [1,6,12,13],
      "청운위실": [1,2,15,16],
      "개인연습실": [1,2,12,13]
    };

    let currentIndex = 0;
    const interval = 10000;

    async function fetchCSV(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP 오류: ${res.status}`);
        const text = await res.text();
        return text.trim().split("\n").map((line) => line.split(","));
      } catch (e) {
        document.getElementById("categoryDisplay").innerHTML =
          "데이터 불러오기 실패: " + e.message;
        return [];
      }
    }

    // 예약된 줄인지 체크하는 함수
    // 헤더와 내용이 같은 경우, 그리고 이름과 현황이 모두 빈 값인 경우 제외
    function isReserved(row, headerRow, colsToShow) {
      if (row.map(cell => cell.trim()).join() === headerRow.map(cell => cell.trim()).join()) return false;

      const nameIdx = colsToShow[0];
      const statusIdx = colsToShow.find(idx => headerRow[idx] === "현황");

      const nameCell = row[nameIdx] ? row[nameIdx].trim() : "";
      const statusCell = statusIdx !== undefined ? (row[statusIdx] ? row[statusIdx].trim() : "") : "";

      if (!nameCell && !statusCell) return false;

      return row.some(cell => cell.trim() !== "");
    }

    async function showCategory(index) {
      const category = sources[index];
      const container = document.getElementById("categoryDisplay");
      container.classList.remove("show");

      const rows = await fetchCSV(category.url);
      if (!rows.length) {
        container.innerHTML = `<h2>${category.name}</h2><p>데이터 없음</p>`;
        container.classList.add("show");
        return;
      }

      let html = `<h2>${category.name}</h2>`;

      if (category.name === "컴퓨터") {
        html += `<div class="notice-box">기본이용시간: 1시간 <span>|</span> 최대이용시간: 2시간</div>`;
      }
      if (category.name === "노래연습실") {
        html += `<div class="notice-box">기본이용시간: 30분</div>`;
      }
      if (category.name === "체육활동실") {
        html += `<div class="notice-box">AR플레이어 : 기본이용시간 30분 <span>|</span> 최대이용시간 1시간 <br>탁구 : 제한없음</div>`;
      }
      if (category.name === "미디어실") {
        html += `<div class="notice-box">닌텐도 : 기본이용시간 30분, 최대이용시간 1시간<br>영화 : 영화 한 편</div>`;
      }

      const colsToShow = visibleColumns[category.name] || [];

      html += `<hr>`;
      html += `<table>`;

      // 헤더 출력
      html += "<tr>";
      rows[0].forEach((colName, idx) => {
        if (colsToShow.includes(idx)) {
          html += `<th>${colName}</th>`;
        }
      });
      html += "</tr>";

      // 데이터 출력 (예약된 줄만)
      rows.slice(1).forEach((row) => {
        if (isReserved(row, rows[0], colsToShow)) {
          html += "<tr>";
          row.forEach((cell, idx) => {
            if (colsToShow.includes(idx)) {
              if (category.name !== "컴퓨터" && idx === 1) {
                html += `<td class="name-cell">${cell}</td>`;
              } else {
                html += `<td>${cell}</td>`;
              }
            }
          });
          html += "</tr>";
        }
      });

      html += "</table>";

      container.innerHTML = html;
      requestAnimationFrame(() => container.classList.add("show"));
    }

    showCategory(currentIndex);
    setInterval(() => {
      currentIndex = (currentIndex + 1) % sources.length;
      showCategory(currentIndex);
    }, interval);
  </script>
</body>
</html>
