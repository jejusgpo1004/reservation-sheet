<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>서청문 예약현황 사이트</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap');
    html, body {
      height: 100%;
      margin: 0;
      background: linear-gradient(135deg, #e0f7fa, #fffde7);
      font-family: 'Nanum Gothic', 'Noto Sans KR', sans-serif;
      color: #3a3a3a;
    }
    #categoryDisplay {
      width: 100%;
      height: 100%;
      padding: 40px 50px;
      box-sizing: border-box;
      overflow-y: auto;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    #categoryDisplay.show { opacity: 1; }
    h2 {
      color: #00796b;
      margin-top: 0;
      font-size: 3em;
      font-weight: 800;
      padding-bottom: 14px;
      text-align: center;
      letter-spacing: 1px;
      user-select: none;
    }
    .notice-box {
      margin: 0 auto 20px auto;
      max-width: 700px;
      background: #e0f7fa;
      color: #00796b;
      font-size: 1.6em;
      font-weight: bold;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid #4db6ac;
      line-height: 2;
    }
    hr {
      border: none;
      border-top: 3px solid #4db6ac;
      margin: 20px 0;
    }
    table {
      border-collapse: separate;
      border-spacing: 0 12px;
      margin-top: 10px;
      width: 100%;
      font-size: 1.4em;
      background: transparent;
      user-select: none;
    }
    th {
      background-color: #4db6ac;
      color: #ffffff;
      padding: 14px 20px;
      text-align: center;
      font-weight: 700;
      border-radius: 10px 10px 0 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    td {
      background: #e0f2f1;
      color: #004d40;
      padding: 16px 20px;
      text-align: center;
      font-weight: 600;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      white-space: nowrap;
    }
    tr:nth-of-type(even) td { background: #b2dfdb; }
    tr:hover td {
      background: #80cbc4;
      color: #00251a;
      cursor: default;
      transition: background-color 0.3s ease;
    }
  </style>
</head>
<body>
<div id="categoryDisplay">로딩 중...</div>
 <script>
    const sources = [
      { name: "컴퓨터", 
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=389966305&single=true&output=csv",
        wantedCols: ["이름", "컴퓨터번호", "시작시간", "현황"],
        filter: (row,i) => {
          if (i===0) return true;
          if (!row[0].trim()) return false;
          const 제외=["학교","연락처","타임스탬프"];
          return !제외.includes(row[0].trim());
        }
      },
      { name: "노래연습실", 
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=459320473&single=true&output=csv",
        wantedCols: ["이름", "노래방", "시작시간", "현황", "참고"],
        filter: (row,i) => {
          if (i===0) return true;
          if (!row[0].trim()) return false;
          return true;
        }
      },
      { name: "미디어실", 
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=1373134857&single=true&output=csv",
        wantedCols: ["이름", "시작시간", "현황", "참고"],
        filter: (row,i) => {
          if (i===0) return true;
          if (!row[0].trim()) return false;
          return true;
        }
      },
      { name: "체육활동실", 
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=93372477&single=true&output=csv",
        wantedCols: ["이름", "이용시설", "시작시간", "현황", "참고"],
        filter: (row,i) => {
          if (i===0) return true;
          if (!row[0].trim()) return false;
          return true;
        }
      },
      { name: "북카페", 
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=660141070&single=true&output=csv",
        wantedCols: ["이름", "시작시간", "현황", "참고"],
        filter: (row,i) => {
          if (i===0) return true;
          if (!row[0].trim()) return false;
          return true;
        }
      },
      { name: "청운위실", 
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=1485760318&single=true&output=csv",
        wantedCols: ["이름", "이용시작시간", "현황", "참고"],
        filter: (row,i) => {
          if (i===0) return true;
          if (!row[0].trim()) return false;
          return true;
        }
      },
      { name: "개인연습실", 
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvd2Sefa0BZEUWNT1V4mnRxbyXyDiRNEepnujdArN5VXZwmoTlYCdsrmC6D8qg_B9YaooV5MLeDvZi/pub?gid=956982417&single=true&output=csv",
        wantedCols: ["이름", "이용시작시간", "현황", "참고"],
        filter: (row,i) => {
          if (i===0) return true;
          if (!row[0].trim()) return false;
          return true;
        }
      }
    ];

  let currentIndex = 0;
  const interval = 10000; // 10초

  async function fetchCSV(url){
    try{
      const res = await fetch(url);
      if(!res.ok) throw new Error(`HTTP 오류: ${res.status}`);
      const text = await res.text();
      return text.trim().split("\n").map(line => line.split(","));
    } catch(e){
      document.getElementById("categoryDisplay").innerHTML = "데이터 불러오기 실패: " + e.message;
      return [];
    }
  }

  async function showCategory(index){
    const category = sources[index];
    const container = document.getElementById("categoryDisplay");
    container.classList.remove("show");

    const rows = await fetchCSV(category.url);
    if(!rows.length){
      container.innerHTML=`<h2>${category.name}</h2><p>데이터 없음</p>`;
      container.classList.add("show");
      return;
    }

    let html = `<h2>${category.name}</h2>`;

    // 안내박스 (필요 시 추가)
    if(category.name === "컴퓨터"){
      html += `<div class="notice-box">기본이용시간: 1시간 <span>|</span> 최대이용시간: 2시간</div>`;
    }
    if(category.name === "노래연습실"){
      html += `<div class="notice-box">기본이용시간: 30분</div>`;
    }

    html += `<hr>`;

    if(category.wantedCols){
      const header = rows[0];
      const wantedIdx = category.wantedCols.map(col => header.indexOf(col));
      let dataRows = [header,...rows.slice(1).filter((row,i)=>category.filter(row,i+1))];

      html += "<table><tr>";
      category.wantedCols.forEach(col=>{
        if(col.includes("이름")){
          html += `<th>이름</th>`;
        } else {
          html += `<th>${col}</th>`;
        }
      });
      html += "</tr>";

      dataRows.slice(1).forEach(row=>{
        html += "<tr>";
        wantedIdx.forEach((idx,i)=>{
          let cellValue = idx>=0?row[idx]:"";
          if(category.wantedCols[i].includes("이름")){
            cellValue = cellValue.length>3?cellValue.slice(0,3):cellValue;
          }
          html += `<td>${cellValue}</td>`;
        });
        html += "</tr>";
      });
      html += "</table>";
    } else {
      // wantedCols 해당 안될 때 전체 보여주기용
      html += "<table>";
      rows.forEach((row,i)=>{
        html += "<tr>";
        row.forEach(cell=>{
          html += i===0?`<th>${cell}</th>`:`<td>${cell}</td>`;
        });
        html += "</tr>";
      });
      html += "</table>";
    }

    container.innerHTML=html;
    requestAnimationFrame(()=>container.classList.add("show"));
  }

  showCategory(currentIndex);
  setInterval(()=>{
    currentIndex=(currentIndex+1)%sources.length;
    showCategory(currentIndex);
  },interval);
</script>
</body>
</html>
